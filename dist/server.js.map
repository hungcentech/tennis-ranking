{"version":3,"sources":["../server/server.js"],"names":["SourceMapSupport","install","db","app","use","express","bodyParser","json","set","get","req","res","filter","query","status","collection","find","toArray","then","matches","metaData","total_count","length","resObj","meta","records","console","log","JSON","stringify","err","message","matchId","ObjectId","params","id","error","_id","limit","next","match","sendFile","path","resolve","post","newMatch","body","created","Date","Match","validateMatch","insertOne","cleanupMatch","result","insertedId","put","update","convertMatch","savedMatch","deleteOne","deleteResult","n","appStart","url","dbName","MongoClient","connect","useUnifiedTopology","client","listen"],"mappings":"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","sourcesContent":["// -----------------------------------------------------------------------------\n\nimport \"babel-polyfill\";\nimport SourceMapSupport from \"source-map-support\";\nimport express from \"express\";\nimport bodyParser from \"body-parser\";\nimport { MongoClient, ObjectId } from \"mongodb\";\nimport path from \"path\";\nimport Match from \"./match.js\";\n\n// -----------------------------------------------------------------------------\n\nSourceMapSupport.install();\nvar db;\nvar app = express();\napp.use(express.static(\"./static\"));\napp.use(bodyParser.json());\napp.set(\"json spaces\", 2);\n\n// -----------------------------------------------------------------------------\n\n// if (process.env.NODE_ENV !== \"production\") {\n//   const webpack = require(\"webpack\");\n//   const webpackDevMiddleware = require(\"webpack-dev-middleware\");\n//   const webpackHotMiddleware = require(\"webpack-hot-middleware\");\n//   const config = require(\"../webpack.config.js\");\n//   config.mode = \"development\";\n//   config.entry.app.push(\"webpack-hot-middleware/client\", \"webpack/hot/only-dev-server\");\n//   config.plugins.push(new webpack.HotModuleReplacementPlugin());\n//   const bundler = webpack(config);\n//   app.use(webpackDevMiddleware(bundler, { noInfo: true }));\n//   app.use(webpackHotMiddleware(bundler, { log: console.log }));\n// }\n\n// -----------------------------------------------------------------------------\n\napp.get(\"/api/matches\", (req, res) => {\n  const filter = {};\n  if (req.query.status) filter.status = req.query.status;\n  // if (req.query.effort_lte || req.query.effort_gte) filter.effort = {};\n  // if (req.query.effort_gte) filter.effort.$gte = parseInt(req.query.effort_gte, 10);\n  // if (req.query.effort_lte) filter.effort.$lte = parseInt(req.query.effort_lte, 10);\n\n  db.collection(\"matches\")\n    .find(filter)\n    .toArray()\n    .then(matches => {\n      const metaData = { total_count: matches.length };\n      const resObj = { meta: metaData, records: matches };\n      console.log(\n        `app.get('/api/matches'): filter = ${JSON.stringify(filter)}, records found = ${\n          resObj.records.length\n        }`\n      );\n      res.json(resObj);\n    })\n    .catch(err => {\n      console.log(\"get('/api/matches'): err =\", err);\n      res.status(500).json({ message: `!!! Internal Server Error: ${err}` });\n    });\n});\n\n// -----------------------------------------------------------------------------\n\napp.get(\"/api/matches/:id\", (req, res) => {\n  let matchId;\n  try {\n    matchId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid match ID format: ${error}` });\n    return;\n  }\n  db.collection(\"matches\")\n    .find({ _id: matchId })\n    .limit(1)\n    .next()\n    .then(match => {\n      if (!match) res.status(404).json({ message: `No such match: ${matchId}` });\n      else res.json(match);\n    })\n    .catch(error => {\n      console.log(error);\n      res.status(500).json({ message: `Internal Server Error: ${error}` });\n    });\n});\n\n// -----------------------------------------------------------------------------\n\napp.get(\"*\", (req, res) => {\n  res.sendFile(path.resolve(\"static/index.html\"));\n});\n\n// -----------------------------------------------------------------------------\n\napp.post(\"/api/matches\", (req, res) => {\n  const newMatch = req.body;\n  console.log(\"post('/api/matches'): newMatch =\", newMatch);\n\n  newMatch.created = new Date();\n  if (!newMatch.status) newMatch.status = \"New\";\n\n  const err = Match.validateMatch(newMatch);\n  if (err) {\n    console.log(\"post('/api/matches'): err =\", err);\n    res.status(422).json({ message: `Invalid requrest: ${err}` });\n    return;\n  }\n\n  db.collection(\"matches\")\n    .insertOne(Match.cleanupMatch(newMatch))\n    .then(result =>\n      db\n        .collection(\"matches\")\n        .find({ _id: result.insertedId })\n        .limit(1)\n        .next()\n    )\n    .then(newMatch => {\n      console.log(\"post('/api/matches'): newMatch =\", newMatch);\n      res.json(newMatch);\n    })\n    .catch(err => {\n      console.log(\"post('/api/matches'): err =\", err);\n      res.status(500).json({ message: `Internal Server Error: ${err}` });\n    });\n});\n\n// -----------------------------------------------------------------------------\n\napp.put(\"/api/matches/:id\", (req, res) => {\n  let matchId;\n  try {\n    matchId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid match ID format: ${error}` });\n    return;\n  }\n\n  const match = req.body;\n  console.log(\"put('api/matches/:id'): match =\", match);\n  delete match._id;\n\n  const err = Match.validateMatch(match);\n  if (err) {\n    res.status(422).json({ message: `Invalid request: ${err}` });\n    return;\n  }\n\n  db.collection(\"matches\")\n    .update({ _id: matchId }, Match.convertMatch(match))\n    .then(() =>\n      db\n        .collection(\"matches\")\n        .find({ _id: matchId })\n        .limit(1)\n        .next()\n    )\n    .then(savedMatch => {\n      res.json(savedMatch);\n    })\n    .catch(error => {\n      console.log(error);\n      res.status(500).json({ message: `Internal Server Error: ${error}` });\n    });\n});\n\n// -----------------------------------------------------------------------------\n\napp.delete(\"/api/matches/:id\", (req, res) => {\n  let matchId;\n  try {\n    matchId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid match ID format: ${error}` });\n    return;\n  }\n  db.collection(\"matches\")\n    .deleteOne({ _id: matchId })\n    .then(deleteResult => {\n      if (deleteResult.result.n === 1) res.json({ status: \"OK\" });\n      else res.json({ status: \"Warning: object not found\" });\n    })\n    .catch(error => {\n      console.log(error);\n      res.status(500).json({ message: `Internal Server Error: ${error}` });\n    });\n});\n\n// -----------------------------------------------------------------------------\n\nconst appStart = function() {\n  const url = \"mongodb://localhost:27017\";\n  const dbName = \"tennis-ranking\";\n\n  MongoClient.connect(url, { useUnifiedTopology: true })\n    .then(client => {\n      console.log(\"appStart(): Connected successfully to mongodb server.\");\n      db = client.db(dbName);\n\n      app.listen(3000, () => {\n        console.log(\"appStart(): Tennis-ranking server started. Listening on port: 3000\");\n      });\n    })\n    .catch(err => {\n      console.log(\"appStart(): DB connection error:\", err);\n    });\n};\n\n// -------------------------------------\n\nappStart();\n\n// -----------------------------------------------------------------------------\n"],"file":"server.js"}